language: python
sudo: required  # workaround prior to official 3.7 support
dist: xenial  # workaround prior to official 3.7 support
python: '3.7'
node_js:
  - "lts/*"

install:
- pip install -r requirements.txt

script: pytest

before_deploy:
- curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
- echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
- sudo apt-get update && sudo apt-get install yarn
- yarn install --ignore-engines  # otherwise eslint sub package clashes with node
- yarn docs:build

deploy:
# for deploying to pypi
- provider: pypi
  on:
    branch: master  # only build on master branch
    tags: true  # only build for tagged pushes
  user: 'shongololo'
  password:  # travis encrypt your-password-here
    secure: 'bWXbA4lxXvEshPyclo6VqiJ7bye3I3UOmW/tiItB+2bEvIbBunyGlLx6Etzgw7UaudtYGVyJT6Urn55YUr7xq3RhLONwoJqa0hpW5D8VutPWVBR8iLAlV+6xJscjxt+SQaSYWi79C+aw2f+jT89YQE+LMR3pScS+y909XttgFYkE+5JVK4EW075zFbvw42Ko7BvjtbuJmfy32x2BqjYNqfdMdyJgXVY6MLpiNDBB5F610jS5UxtggUhDd5dmla5GRLaCTCkl+GOh1klj2sGnZMB8ljbJ1h1aEEDTWG8mJOuwiKHdfglXbpLxX7TN6nM5bu41+WO2VwSuyvXdUiJ2rH3LrjsHEK1EX2r6iEEe66IUUIBgkOKVSqjB8DQmvEKgmjq8qnsEuz2M1Ieu/wuUE3QkBf+rlx+ozhVVxSIoRH+fxCUxck1CPmWKZxdCvO+fISlS4hotOiwXXDIIpYQTIyM7oS0bdQQ0zIRARyS/bNGdMynZrMm3aB8ZjlvK6tIGu4tLSAV1zEsW7o7G9ntK0jJTLIgEGqESQhjtxD587qjfIgQ83A6x2AGJJy60BXRttCr470o/SjVDkesAtdStVCC0P4/oEt4WexLu4RPnR+aJEqqIv2EPmyZBAbxNqM2foMZyXHwthrmtx70Hi97U2CLxZIenC2wexOsMi+l8Pnc='
  distributions: "sdist bdist_wheel"  # default is only sdist, so upload linux wheel as well
  skip-existing: true
# for deploying docs
- provider: pages
  on:
    branch: master  # only build on master branch
    tags: false  # only build for tagged pushes
  local-dir: docs/.vuepress/dist
  target-branch: gh-pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN  # Generate personal token in github, then set in travis settings page as a secure variable
  keep-history: true
