language: python
sudo: required  # workaround prior to official 3.7 support
dist: xenial  # workaround prior to official 3.7 support
python: '3.7'
node_js:
  - "lts/*"

install:
- pip install -r requirements.txt

script: pytest

before_deploy:
- curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
- echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
- sudo apt-get update && sudo apt-get install yarn
- yarn install --ignore-engines  # otherwise eslint sub package clashes with node
- yarn docs:build

deploy:
# for deploying to pypi
- provider: pypi
  on:
    branch: master  # only build on master branch
    tags: true  # only build for tagged pushes
  user: 'shongololo'
  password:  # travis encrypt your-password-here
    secure: oTHOOXzRdiAmuFNetd3StXBfTdvpE17vudwWjrp1tWovYf+qoO7wxRDg7ZCN8oGaqkNPq7Si5aerRlNcoVcFO9882ewUU0BAWIXlzjN0K4AjXxhrsG0JmAOdCzWjseVca39GQ4oR8FCOCs1lsdKBWVxvGUhJkGznj9DXKFf4hoTMS01yiHKrM2yVnQD10Vzg/p/4GDr+uij2J10ngJQy4L1ARTf0oYFChDNeTBAo/rVVIS6WIsyB29dyzXz4p8aitE6hyC4GfJPUcdL4zOWiVIYgBfuoZMsGbSZ1aDvN6XRsE2iiwVfQr+gbp0MKYBveg36JHtYKSawVxgAhdlTz1cdBflbY4ye5h+vWAm+T8nFwlVFZK7+WwBNi0Jms8E8nSuUxwPYjqifnpfgshIll4z19BIgHpSvnNAI9Ina9L62NRSiB1jwbBkN80THvIutl5BRomy5gL/RIZLPtJhWJiO5ZVF/jplsxrQLa7llCzGDOtHKFCuBOt3WbpNOwg5QKO0NQTNo7izxrN9ctg4bkVKzL9eGoam4dARFWSBrS3DviMl2hppIdBcS96GdsE5uzg0HykF8z3t7g+WLeROe/vEZc6HL+kgxf3y5PZBiUMU3RGswg4bPse1u/GoAkBz8RFTtgqj+rCVTr3TQRypPAFXINukmfDLvmv1c+glu0b5g=
  distributions: "sdist bdist_wheel"  # default is only sdist, so upload linux wheel as well
  skip-existing: true
# for deploying docs
- provider: pages
  on:
    branch: master  # only build on master branch
    tags: false  # only build for tagged pushes
  local-dir: docs/.vuepress/dist
  target-branch: gh-pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN  # Generate personal token in github, then set in travis settings page as a secure variable
  keep-history: true
